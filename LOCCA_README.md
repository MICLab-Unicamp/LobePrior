# LOCCA: Manual annotations for lung lobes in CT images of patients with cancer and COVID-19

This repository contains medical image files, annotations, visualization scripts, and a tutorial to assist with data manipulation and analysis. The files are organized to support studies and experiments with biomedical imaging, particularly in lung computed tomography (CT).

The main formats used here are:

    NIfTI (.nii, .nii.gz): widely adopted format in neuroimaging and 3D medical imaging.

    NRRD (.nrrd): commonly used for storing medical annotations, such as manual segmentations.


## Repository Contents

1. **Compressed folder with annotations in NRRD format (`.nrrd`)**
   - Two compressed folder containing **segmented annotations** of the medical images.
   - Folder with files used to represent anatomical masks such as lung lobes.
   - Compatible with visualization and editing software like **ITK-Snap** and **3D Slicer**.

2. **Compressed folder with Volumetric Image in NIfTI format (`.nii.gz`)**
   - Folder containing the high-resolution CT volumes of the HCU dataset.
   - Widely used format in medical imaging, compatible with **NiBabel**, **3D Slicer**, **ITK-Snap**, among others.

3. **Compressed folder containing files and scripts**
   - Contains **Python scripts** with examples of loading, visualizing, and analyzing the images and annotations.
   - It also includes a guide on how to use the ITK-SNAP software.
   - Includes plots, 2D/3D visualizations, and basic analyses using libraries such as `nibabel`, `matplotlib`, `numpy`, `SimpleITK`, and `itk`.

4. **Tutorial PDF**
   - Practical guide on how to use **ITK-Snap** to view and edit images and annotations.
   - Step-by-step instructions with screenshots.

---

## Recommended Software

### 1. **ITK-Snap**
- Free software for semi-automatic segmentation and annotation of medical images.
- Supports `.nii.gz` and `.nrrd` files with overlay visualization.
- Website: [http://www.itksnap.org](http://www.itksnap.org)

### 2. **3D Slicer**
- Open-source platform for 3D visualization and analysis of medical data.
- Supports multiple formats including `.nrrd` and `.nii.gz`.
- Allows quantitative analysis, segmentation, and 3D rendering.
- Website: [https://www.slicer.org](https://www.slicer.org)

### 3. **Python (Jupyter Notebooks)**
- Interactive environment for developing and visualizing data using Python scripts.
- Useful libraries:
  - `nibabel`: to read `.nii.gz` files
  - `simpleitk` / `itk`: for medical image processing
  - `numpy`, `matplotlib`: for analysis and visualization
- Recommended tools: **JupyterLab** or **VS Code**

---

## Requirements to Run the Notebooks

Install the following packages using `pip` or `conda`:

```bash
pip install nibabel simpleitk numpy matplotlib jupyter pynrrd
```

Or with Conda:

```bash
conda install -c conda-forge nibabel simpleitk matplotlib jupyter pynrrd
```

---

## How to Visualize the Images

1. **In ITK-Snap**:
   - Load the `.nii.gz` file as the main image.
   - Load the `.nrrd` files as additional segmentations.
   - Use the PDF tutorial for detailed guidance.

2. **In 3D Slicer**:
   - Go to `Add Data` and select both the image and annotation files.
   - Use the segmentation and 3D visualization modules.

3. **In Jupyter Notebook**:
   - Run the provided notebook.
   - Visualize image slices and segmentations or generate basic 3D renderings.
   - The images and their annotations can also be read using NumPy, with Python code.

---

## File Structure

```
📦 annotations_HCU.zip              # Annotations for the HCU dataset
 ├── locca_covid_001_label.nrrd
 ├── locca_covid_002_label.nrrd
 ├── locca_covid_003_label.nrrd
     .
     .
     .
 └── locca_covid_030_label.nrrd

📦 annotations_Task06-Lung.zip       # Annotations for the Task06-Lung dataset
 ├── lung_001_label.nrrd
 ├── lung_002_label.nrrd
 ├── lung_003_label.nrrd
     .
     .
     .
 └── lung_096_label.nrrd

📦 images_HCU.zip                    # Volumetric images of the HCU dataset
 ├── locca_covid_001.nii.gz
 ├── locca_covid_002.nii.gz
 ├── locca_covid_003.nii.gz
     .
     .
     .
 └── locca_covid_030.nii.gz

📦 scripts.zip
 ├── 📁 images/                    # Folder containing the images generated by the scripts
 ├── 📁 input/                     # Folder containing input files for running the scripts
 ├── 📁 output_HCU/                # Folder containing output files generated during the execution of the scripts on the HCU dataset
 ├── 📁 output_Task06/             # Folder containing output files generated during the execution of the scripts on the Task06-Lung dataset
 ├── dataset_HCU.ipynb             # Jupyter Notebook with analysis scripts of the HCU dataset
 ├── dataset_Task06.ipynb          # Jupyter Notebook with analysis scripts of the Task06-Lung dataset
 ├── intensities_and_slices.ipynb  # Jupyter Notebook with analysis scripts of the HCU and Task06-Lung datasets
 ├── ITK-Snap_guide.pdf            # PDF tutorial for ITK-Snap usage
 └── load_image_and_annotation.py  # Script to load CT images and their annotations using the Python environment. The requirements are listed in the file header.
```

---

## Instructions for Using the Script

This script allows you to load and visualize 3D CT scans along with their corresponding annotations (e.g., segmentation masks). It is intended for medical imaging tasks using Python.

▶️ **How to Run the Script using the terminal**

```bash
python load_image_and_annotation.py -image data/images/patient_001.nii.gz --mask data/labels/patient_001.nrrd
```

🖼️ **ITK-Snap**

ITK-Snap is a free, open-source software for semi-automatic and manual segmentation of 3D medical images. It supports common formats like NIfTI, DICOM, MetaImage, among others, and allows visualization of volumetric images, creation of segmentation masks, and saving results for further analysis.

   - View ITK-Snap guide.pdf

---

## Location

The dataset can be found at [LOCCA](https://redu.unicamp.br/dataset.xhtml?persistentId=doi:10.25824/redu/ORXJKS).


---

## License

This material is distributed for academic and research purposes only. Please check the usage terms of the included data and tools.

---

## Contact

Jean A. Ribeiro  
University of Campinas (Unicamp)  
Email: j265739@dac.unicamp.br
